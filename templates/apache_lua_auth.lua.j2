require "apache2"
function authz_check_usergroup(r)
    if r.user == nil then
        return apache2.AUTHZ_DENIED_NO_USER
    end
    username = string.match(r.user, '(.*)@')
    username = string.match(username, '[a-zA-Z0-9.-]+')
    if string.find(io.popen('id ' .. username):read(), '{{ apache_lua_users_group }}', 1, true) ~= nil then
        return apache2.AUTHZ_GRANTED
    end
    return apache2.AUTHZ_DENIED
end
